# AN츼LISIS DE LENTITUD EN CARGA DE PDFs

## 游댌 POSIBLES CAUSAS IDENTIFICADAS:

### 1. **CONFIGURACI칍N DE react-pdf**
- **Problema**: Las opciones actuales est치n optimizadas para velocidad pero pueden causar problemas
- **Configuraci칩n actual**:
  ```javascript
  options={{
    cMapUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/cmaps/',
    cMapPacked: true,
    standardFontDataUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/standard_fonts/',
    disableFontFace: true,
    disableRange: true,
    disableStream: true,
  }}
  ```

### 2. **TAMA칌O DE P츼GINA INICIAL**
- **Problema**: El tama침o inicial es muy peque침o (400x300) y luego se ajusta
- **C칩digo actual**:
  ```javascript
  const [pageSize, setPageSize] = useState<{ width: number; height: number }>({ width: 400, height: 300 });
  ```

### 3. **TIMEOUT MUY LARGO**
- **Problema**: 15 segundos es demasiado tiempo para esperar
- **C칩digo actual**:
  ```javascript
  setTimeout(() => {
    if (loading) {
      setError('El PDF tard칩 demasiado en cargar...');
    }
  }, 15000); // 15 segundos
  ```

### 4. **RENDERIZADO DE CAPAS**
- **Problema**: Se est치n deshabilitando capas importantes
- **C칩digo actual**:
  ```javascript
  renderTextLayer={false}
  renderAnnotationLayer={false}
  ```

### 5. **URLs DE SUPABASE STORAGE**
- **Problema**: Las URLs se construyen din치micamente y pueden tener problemas de CORS
- **C칩digo actual**:
  ```javascript
  fileUrl = `https://ueufprdedokleqlyooyq.supabase.co/storage/v1/object/public/${rawUrl}`;
  ```

## 游 SOLUCIONES PROPUESTAS:

### 1. **OPTIMIZAR CONFIGURACI칍N DE react-pdf**
```javascript
options={{
  cMapUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/cmaps/',
  cMapPacked: true,
  standardFontDataUrl: 'https://unpkg.com/pdfjs-dist@3.11.174/standard_fonts/',
  disableFontFace: false, // Habilitar para mejor renderizado
  disableRange: false,    // Habilitar para streaming
  disableStream: false,   // Habilitar para mejor rendimiento
}}
```

### 2. **REDUCIR TIMEOUT**
```javascript
setTimeout(() => {
  if (loading) {
    setError('El PDF tard칩 demasiado en cargar...');
  }
}, 8000); // Reducir a 8 segundos
```

### 3. **MEJORAR TAMA칌O INICIAL**
```javascript
const [pageSize, setPageSize] = useState<{ width: number; height: number }>({ width: 500, height: 400 });
```

### 4. **HABILITAR CAPAS IMPORTANTES**
```javascript
renderTextLayer={true}  // Para selecci칩n de texto
renderAnnotationLayer={true}  // Para enlaces y anotaciones
```

### 5. **AGREGAR PRELOADING**
```javascript
// Preload PDF antes de mostrar
const [isPreloaded, setIsPreloaded] = useState(false);
```

### 6. **MEJORAR MANEJO DE ERRORES**
```javascript
const onDocumentLoadError = (error: Error) => {
  console.error('Error espec칤fico del PDF:', error);
  setError(`Error al cargar PDF: ${error.message}`);
  setLoading(false);
};
```

## 游늵 M칄TRICAS A MONITOREAR:

1. **Tiempo de carga inicial**: Deber칤a ser < 3 segundos
2. **Tiempo de renderizado**: Deber칤a ser < 2 segundos
3. **Tama침o del archivo**: PDFs > 10MB pueden ser problem치ticos
4. **Velocidad de red**: Conexiones lentas afectan significativamente

## 游댢 PR칍XIMOS PASOS:

1. Implementar las optimizaciones propuestas
2. Agregar m칠tricas de rendimiento
3. Considerar lazy loading para PDFs grandes
4. Implementar cache local para PDFs frecuentemente accedidos
5. Agregar indicador de progreso m치s detallado 